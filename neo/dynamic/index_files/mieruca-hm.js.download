(()=>{var _={t:/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i,m:/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/};function g(){let e=navigator?.userAgent||navigator?.vendor||window?.opera||"";return _.t.test(e)?"t":_.m.test(e)?"m":"d"}function M(e){let t=e;for(;t&&t.nodeType===Node.ELEMENT_NODE;){if(t.nodeName==="A"&&(t.hasAttribute("href")||t.hasAttribute("xlink:href")))return t;t=t.parentElement}return null}function b(e){return e?.getAttribute("href")||e?.getAttribute("xlink:href")||e?.getAttributeNS?.("http://www.w3.org/1999/xlink","href")||e?.href||""}function W(e,t){if(t?.nodeName==="IMG")return t.alt||"";let r=e.getElementsByTagName("img");return r.length>0&&r[0].alt||""}function E(e){let t=M(e);if(t){let s=b(t),u=t.innerText||"";return u.trim().length===0?{txt:W(t,e),href:s}:{txt:u,href:s}}if(e.nodeName==="IMG"){let s=e;return{txt:s.alt||"",href:s.src||""}}let r=e.innerText||"",c=b(e);return r.trim().length===0&&(r=W(e)),{txt:r,href:c}}var f={popupEndpoint:"hpjp.mieru-ca.com/embed",wsEndpoint:"ntjp.mieru-ca.com/hm"};function p(e,t,r=window.location){let c=`${r.protocol}//${f.popupEndpoint}`,s=new URLSearchParams({service:"heatmap-popup",tokenId:e,protocol:r.protocol,hostname:r.hostname,pathname:r.pathname,search:r.search,hash:r.hash,dv:t});return`${c}?${s}`}function m(e,{protocol:t=window.location.protocol==="https:"?"wss:":"ws:",wsEndpoint:r=f.wsEndpoint}={}){return`${t}//${r}?sId=${e}`}var T=function(){var e={local_url:window.location.href,referrer_url:document.referrer,sWs:m(window.__fid[0][0]),HM:{},site_id:window.__fid[0][0],temp_scroll_pos:0,idl:null,iwc:0,ire:0,time_out:!1,chkPrevEvent:null,temp_x_pos:0,temp_y_pos:0,read_check:null,href:"",text:"",ipa:0,sChk:null,tempXp:0,tempYp:0,device:g()},t=0,r=0,c=0,s=0,u=0,a=null,l=T.prototype={initWindowElement:function(){var i=document.body||{scrollTop:0,scrollHeight:0,offsetHeight:0,scrollLeft:0,offsetWidth:0,clientWidth:0},n=document.documentElement||{scrollTop:0,clientHeight:0,scrollHeight:0,clientWidth:0,scrollWidth:0,offsetWidth:0,offsetHeight:0};u=Math.floor(n.scrollTop||i.scrollTop||window.pageYOffset),t=Math.max(i.scrollHeight,i.offsetHeight,n.clientHeight,n.scrollHeight,n.offsetHeight),r=Math.max(i.scrollLeft,i.offsetWidth,n.clientWidth,n.scrollWidth,n.offsetWidth),s=Math.floor(window.innerWidth||n.clientWidth||i.clientWidth),c=Math.floor(window.innerHeight+u>t?t:window.innerHeight)},sendPageView:function(){if("WebSocket"in window)a=new WebSocket(e.sWs+(e.ire?"&retry=1":""));else if("MozWebSocket"in window)a=new MozWebSocket(e.sWs+(e.ire?"&retry=1":""));else return;e.iwc=0,l.initWindowElement(),a.onopen=function(){var o={};o.type="p",o.sId=e.site_id,o.url=e.local_url,o.refUrl=e.referrer_url,o.d=e.device,o.sP=c,o.dH=t,o.wW=s,o.wH=c,o.ipa="ipa",o.ua=navigator.userAgent||navigator.vendor||window.opera,a.sendMessage(JSON.stringify(o))},a.onclose=function(o){e.iwc=1},a.onerror=function(o){e.ire===0&&!window.__hmrid&&(e.ire=1,setTimeout(()=>{l.sendPageView()},500))},a.sendMessage=function(o){o!==""&&e.iwc===0&&a.readyState===a.OPEN&&a.send(o)},a.onmessage=function(o){if(o.data==="IS_ALLOW_LOAD_POPUP"){l.popupHandle();return}if(o.data.startsWith("refId-")){window.__hmrid=o.data.split("-")[1];return}if(o.data.startsWith("urlId-")){window.__hmuid=o.data.split("-")[1];return}};var i=document.querySelectorAll("label,a,input,button,textarea,img,iframe,video"),n=0;for(n;n<i.length;n+=1)l.setEventClickListener(i[n]);window.addEventListener("scroll",function(){e.time_out||(l.scrollHandle(),l.readHandle(),l.resetTimeOut())}),l.resetTimeOut()},readHandle:function(){clearTimeout(e.read_check),e.read_check=setTimeout(function(){if(l.initWindowElement(),u!==0){var i={};i.type="r",i.rP=Math.floor(window.innerHeight+u)>=t?Math.floor(t-window.innerHeight):Math.floor(u),i.dH=t,i.wW=Math.floor(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth),i.wH=c,i.d=e.device,a.sendMessage(JSON.stringify(i))}},4e3)},scrollHandle:function(){clearTimeout(e.sChk),e.sChk=setTimeout(function(){l.initWindowElement();var i=Math.floor(document.documentElement.scrollTop||document.body.scrollTop||window.pageYOffset||0)+c;if(i>e.temp_scroll_pos){e.temp_scroll_pos=i;var n={};n.type="s",n.sP=i>=t?t:i,n.dH=t,n.wW=s,n.wH=c,n.d=e.device,a.sendMessage(JSON.stringify(n))}},300)},resetTimeOut:function(){e.idl!==null&&clearTimeout(e.idl),e.idl=setTimeout(function(){e.time_out=!0,e.idl=null},6e5)},setEventClickListener:function(i){i.addEventListener("click",function(n){if(l.initWindowElement(),!e.time_out){n=n||window.event;var o=50,h=n.pageX!==void 0?Math.floor(n.pageX):0,w=n.pageY!==void 0?Math.floor(n.pageY):0,x=Math.abs(e.tempXp-h)<o,H=Math.abs(e.tempYp-w)<o;if(e.device==="m"&&x&&H){if(this.nodeName!=="A")return;clearTimeout(e.chkPrevEvent)}e.tempXp=h,e.tempYp=w;var d={};let v=E(this);if(d.txt=v.txt,d.href=v.href,d.type="c",d.xP=h,d.yP=w,d.dW=r,d.dH=t,d.wW=s,d.d=e.device,e.chkPrevEvent)return;a.sendMessage(JSON.stringify(d)),e.chkPrevEvent=setTimeout(function(){e.chkPrevEvent=null},300)}},!0)},popupHandle:function(){let i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src=p(window.__fid[0][0],e.device);let n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(i,n)}};this.init=function(){setTimeout(()=>{l.sendPageView()},500)}};(function(){window.__mieruca_heatmap=new T,window.__mieruca_heatmap.init()})();})();
