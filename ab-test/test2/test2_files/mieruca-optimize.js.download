var mierucaOptimize=function(){this.protocol=window.location.protocol,this.getCombineCookie=e=>{var t=new Set;return document.cookie.split("; ").forEach((i=>{let[o,n]=i.split("=");o.startsWith(e)&&t.add(n)})),[...t].join(";")},this.getSessionIdFromCookie=e=>{for(var t=document.cookie.split("; "),i="",o=0;o<t.length;o++){let[n,r]=t[o].split("=");if(n.startsWith(e)){i=r.split("_")[1];break}}return i};var e,t,i,o=this.getCombineCookie,n=function(){window.__mieruca_optimize_queue=[],window.__mieruca_optimize.init()};this.init=()=>{e=new URL(window.location.href),t=e.searchParams,i=this.protocol,window.__mieruca_optimize_eventTracker=window.__mieruca_optimize_eventTracker||{},window.__mieruca_optimize_queue=window.__mieruca_optimize_queue||[],window.__mieruca_optimize_identify_num=window.__mieruca_optimize_identify_num||1;for(let e=0;e<window.__optimizeid.length;e++){let i=window.__optimizeid[e][0];if(!window.__mieruca_optimize_queue.includes(i)){if(window.__mieruca_optimize_queue.push(i),_(i),s())return;l(),r(i),t.has("_mo_ab_preview_mode")?m(i):t.has("_mo_ab_preview_pid")?a(i):c(i)}}if(!window.__mieruca_optimize_url_change_handler){window.__mieruca_optimize_url_change_handler=!0;let e=moGenerateKeyAI("ReloadAbProcessEvent");window.__mieruca_optimize_eventTracker[e]=moInitKeyTracker(),moUrlChangeListener.bind(this)(n,null,e,!0)}};var r=t=>{let n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=i+"//ntopt.mieru-ca.com/redirect-url/embed?siteId="+moEncode(t)+"&visitorUrl="+moEncode(e.toString())+"&dv="+moEncode(d())+"&ck="+moEncode(o("__MOR-"))+"&referUrl="+moEncode(document.referrer)+"&ua="+moEncode(navigator.userAgent),moAddElementScript(n)},a=e=>{let o=t.get("dv")||d(),n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=i+"//ntopt.mieru-ca.com/ab/preview?sId="+moEncode(e)+"&dv="+moEncode(o)+"&pId="+moEncode(t.get("_mo_ab_preview_pid")||""),moAddElementScript(n)},c=t=>{let n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=i+"//ntopt.mieru-ca.com/ab/embed?siteId="+moEncode(t)+"&visitorUrl="+moEncode(e.toString())+"&dv="+moEncode(d())+"&ck="+moEncode(o("__MOAB-"))+"&ua="+moEncode(navigator.userAgent),moAddElementScript(n)},m=e=>{const o=new URL(window.location.href),n=new URLSearchParams(o.search);n.delete("_mo_ab_preview_mode"),o.search=n.toString();let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=i+"//ntopt.mieru-ca.com/ab/view?sId="+moEncode(e)+"&visitorUrl="+moEncode(o.toString())+"&pId="+moEncode(t.get("_mo_ab_preview_mode")||""),moAddElementScript(r)},d=()=>{var e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"TABLET":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?"MOBILE":"DESKTOP"},s=()=>{var e=navigator.userAgent;return/MierucaHeatmap|fabercompany.co.jp/.test(e)},l=()=>{if(t.has("_mo")){var i=!1;t.get("_mo").split(";_;").forEach((function(e){var[t,o]=e.split(":");if(document.cookie.split("; ").forEach((e=>{let[n,r]=e.split("=");t===n&&o===r&&(i=!0)})),!i){var n=new Date;n.setTime(n.getTime()+80352e5);var r=n.toUTCString(),a="."+window.location.host.replace("www.",""),c=moEncode(t),m=moEncode(o);document.cookie=`${c}=${m};domain=${a};expires=${r};path=/;`}})),t.delete("_mo"),e.search=t.toString()}},_=e=>{window.opener&&document.referrer&&"https://app.mieru-ca.com"===new URL(document.referrer).origin&&window.addEventListener("message",(t=>{if("https://app.mieru-ca.com"!==t.origin)return;let i=t.data;if("VISUAL_EDITOR_SCRIPT"===i.action)if("open"===i.status&&i.code===e){window.__mosCode=i.code,t.source.postMessage({action:"VISUAL_EDITOR_SCRIPT",status:"ready"},t.origin);const e="https://opt.mieru-ca.com/service/js/mieruca-optimize-ve",o="UTF-8"===document.characterSet?"":"-sjis",n=(new Date).getTime();let r=document.createElement("script");r.type="text/javascript",r.async=!0,r.src=`${e}${o}.js?v=${n}`,moAddElementScript(r)}}))}},moObserverHandler=function(e,t,i={childList:!0,subtree:!0,attributes:!0,characterData:!0}){let o=new MutationObserver(((i,o)=>{e&&e(t,i,o)}));return o.observe(document.body,i),o},moUrlChangeListener=function(e,t,i,o){moObserverHandler((function(){moIsUrlChange(i)&&window.__mieruca_optimize_eventTracker[i].isRerun&&(window.__mieruca_optimize_eventTracker[i].previousUrl=location.href,window.__mieruca_optimize_eventTracker[i].isRerun=o,e&&e(t))}),null,{childList:!0,subtree:!0})},moElChangeListener=function(e,t,i,o){moObserverHandler((function(){!moIsUrlChange(i)&&window.__mieruca_optimize_eventTracker[i].isRerun&&(window.__mieruca_optimize_eventTracker[i].previousUrl=location.href,window.__mieruca_optimize_eventTracker[i].isRerun=o,e&&e(t))}),null,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["id","class","href"]})},moIsUrlChange=e=>location.href!==window.__mieruca_optimize_eventTracker[e].previousUrl,moGetELByXpath=e=>document.evaluate(e,document.body,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,moWrap=(e,t)=>{moInsertBefore(t,e),e.appendChild(t)},moInsertAfter=(e,t)=>{e.parentNode.insertBefore(t,e.nextSibling)},moInsertBefore=(e,t)=>{e.parentNode.insertBefore(t,e)},moHashString=async e=>{try{const t=(new TextEncoder).encode(e),i=await crypto.subtle.digest("SHA-256",t),o=Array.from(new Uint8Array(i));return o.map((e=>e.toString(16).padStart(2,"0"))).join("")}catch(e){console.log(e)}},moApplyChange=async(stacks,mutations,observer)=>{try{let finalJS,finalCSS;for(let i=0;i<stacks.length;i++){let item=stacks[i];if("CODE"===item.type){if(item.isCompleteSetting)continue;item.html&&(document.body.innerHTML=item.html),finalCSS=item.css,finalJS=item.javaScript,item.isCompleteSetting=!0;continue}let currentEle=moGetELByXpath(item.xpath);if(!currentEle)continue;let currentEleHtml=currentEle.outerHTML,hashData=await moHashString(currentEleHtml).then((e=>e));if(item.hash===hashData){if("MOVE"===item.type||"DUPLICATE"===item.type){let e=moGetELByXpath(item.desXpath);if(!e)continue;let t=e.outerHTML,i=await moHashString(t).then((e=>e));if(item.desHash!==i)continue}if(!item.isCompleteSetting){item.isCompleteSetting=!0;try{eval(item.script)}catch(e){console.log(e)}}}}if(finalCSS&&moAppendCss(finalCSS),finalJS)try{eval(finalJS)}catch(e){console.log(e)}if(observer){let e=stacks.filter((e=>!e.isCompleteSetting));0===e.length&&observer.disconnect()}}catch(e){console.log(e)}},moAppendCss=e=>{let t=document.getElementById("mo-visual-editor-style");if(t)t.firstChild?t.replaceChild(document.createTextNode(e),t.firstChild):t.appendChild(document.createTextNode(e));else{let t=document.createElement("style");t.type="text/css",t.id="mo-visual-editor-style",t.appendChild(document.createTextNode(e)),document.head.appendChild(t)}},moAddEventListeners=e=>{e.forEach((e=>{e.elFn().forEach((t=>{t.addEventListener("click",e.clFn)}))}))},moRemoveEventListeners=e=>{e.forEach((e=>{e.elFn().forEach((t=>{t.removeEventListener("click",e.clFn)}))}))},moEncode=e=>encodeURIComponent(e),moLinkageGoal=()=>{var e=window.__mieruca_optimize,t=window.__hmrid,i=window.__hmuid,o=e.getSessionIdFromCookie("__MOAB-");if(t&&i&&o){const n=e.protocol+"//ntopt.mieru-ca.com/hm/record/goal?rId="+moEncode(t)+"&uId="+moEncode(i)+"&sesId="+moEncode(o);fetch(n,{method:"GET",mode:"no-cors"}).then().catch((e=>console.log(e)))}},moAddElementScript=e=>{let t=document.getElementsByTagName("script")[0];t?t.parentNode.insertBefore(e,t):document.head.appendChild(e)},moGenerateKeyAI=e=>`${e}-${window.__mieruca_optimize_identify_num++}`,moInitKeyTracker=()=>({previousUrl:location.href,isRerun:!0});window.__mieruca_optimize_queue=window.__mieruca_optimize_queue||[],window.__mieruca_optimize=new mierucaOptimize,window.__mieruca_optimize.init();